## å®éªŒäºŒï¼šROS åŸºç¡€ä¸é€šä¿¡æœºåˆ¶

### 1. å®éªŒç›®çš„

* ç†è§£ ROS èŠ‚ç‚¹ï¼ˆNodeï¼‰æ¦‚å¿µ
* æŒæ¡è¯é¢˜ï¼ˆTopicï¼‰å‘å¸ƒ-è®¢é˜…æœºåˆ¶
* æŒæ¡æœåŠ¡ï¼ˆServiceï¼‰è¯·æ±‚-å“åº”æœºåˆ¶
* ç†è§£ ROS Master çš„ä½œç”¨

### 2. ROS æ ¸å¿ƒæ¦‚å¿µ

#### 2.1 åŸºæœ¬ç»„æˆ

* **Nodeï¼ˆèŠ‚ç‚¹ï¼‰** ï¼šROS ç³»ç»Ÿçš„åŸºæœ¬è¿è¡Œå•å…ƒï¼Œæ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œç‰¹å®šä»»åŠ¡
* **Topicï¼ˆè¯é¢˜ï¼‰** ï¼šèŠ‚ç‚¹é—´é€šä¿¡çš„å‘½åé€šé“
* **Message Typeï¼ˆæ¶ˆæ¯ç±»å‹ï¼‰** ï¼šå®šä¹‰è¯é¢˜ä¸Šä¼ è¾“çš„æ•°æ®æ ¼å¼
* **Masterï¼ˆä¸»èŠ‚ç‚¹ï¼‰** ï¼šæä¾›èŠ‚ç‚¹é—´é€šä¿¡çš„åè°ƒæœåŠ¡ï¼ˆéœ€è¦ `roscore`ï¼‰

#### 2.2 é€šä¿¡ç±»å‹å¯¹æ¯”

| é€šä¿¡æ–¹å¼          | ç‰¹ç‚¹             | ä½¿ç”¨åœºæ™¯             | æ¯”å–»     |
| ----------------- | ---------------- | -------------------- | -------- |
| **Topic**   | å¼‚æ­¥ï¼ŒæŒç»­æ•°æ®æµ | ä¼ æ„Ÿå™¨æ•°æ®ã€çŠ¶æ€ä¿¡æ¯ | å¹¿æ’­ç”µå° |
| **Service** | åŒæ­¥ï¼Œè¯·æ±‚-å“åº”  | è®¡ç®—ã€æŸ¥è¯¢ã€è§¦å‘åŠ¨ä½œ | æ‰“ç”µè¯   |

### 3. å®éªŒæ­¥éª¤

#### å®éªŒ 2.1ï¼šä½“éªŒæ— é€šä¿¡çš„å­¤ç«‹ç¨‹åº

```bash#
cd ~/catkin_ws/src/ros_course_examples/simulation_demo
python3 controller.py

# ç»ˆç«¯ 2ï¼šè¿è¡Œ Motor
cd ~/catkin_ws/src/ros_course_examples/simulation_demo
python3 motor.py
```

æ‰§è¡Œæ•ˆæœå¦‚å›¾ï¼š![1766556330841](image/2.ros_experiment/1766556330841.png)

**è§‚å¯Ÿ** ï¼šä¸¤ä¸ªç¨‹åºå„è‡ªè¿è¡Œï¼Œæ— æ³•ç›¸äº’é€šä¿¡ã€‚

å…³é—­è¿™ä¸¤ä¸ªç¨‹åºå§ã€‚

#### å®éªŒ 2.2ï¼šä½¿ç”¨ ROS å®ç°èŠ‚ç‚¹é€šä¿¡

æˆ‘ä»¬å¯ä»¥å°†ä»£ç å°è£…æˆç»“ç‚¹ï¼Œç„¶ååŸºäºROSæ¡†æ¶å®ç°ç»“ç‚¹é€šä¿¡ã€‚

é¦–å…ˆè¿›è¡Œç¼–è¯‘

åœ¨ç»ˆç«¯ 1ï¼šç¼–è¯‘roså·¥ä½œç©ºé—´

```bash
cd ~/catkin_ws
catkin_make
```

å¤§æ¦‚çš„ç¤ºæ„å›¾ï¼š
![1766556827503](image/2.ros_experiment/1766556827503.png)

ç»ˆç«¯ 1ï¼šå¯åŠ¨ ROS Master

```bash
roscore
```

![1766557292995](image/2.ros_experiment/1766557292995.png)

```bash
cd ~/catkin_ws/src/ros_course_examples/nodes/  
chmod +x motor_node.py
chmod +x controller_node.py
```

![1766557275580](image/2.ros_experiment/1766557275580.png)

å¯åŠ¨é€šä¿¡æ¼”ç¤º

ç»ˆç«¯ 2ï¼šå¯åŠ¨ç”µæœºç»“ç‚¹

```bash
cd ~/catkin_ws
source devel/setup.bash
rosrun ros_course_examples motor_node.py
```

ä½ å¯ä»¥å‘ç°è¿™ä¸ªç»“ç‚¹ï¼ˆç¨‹åºï¼‰æ­£åœ¨ç­‰å¾…ä¿¡æ¯ï¼Œå®ƒçš„ä½ç½®å¹¶ä¸å‘ç”Ÿæ”¹å˜ã€‚
![1766558557910](image/2.ros_experiment/1766558557910.png)

ç»ˆç«¯ 3ï¼šå¯åŠ¨æ§åˆ¶å™¨ç»“ç‚¹
æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬æ§åˆ¶å®ƒ

```bash
cd ~/catkin_ws
source devel/setup.bash
rosrun ros_course_examples controller_node.py
```

è§‚å¯Ÿç»ˆç«¯ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å®ƒæ­£åœ¨ä¸æ–­çš„å‘é€æŒ‡ä»¤ï¼š
![1766559045635](image/2.ros_experiment/1766559045635.png)

è¿”å›æŸ¥çœ‹ç»ˆç«¯2ï¼ˆç”µæœºç»“ç‚¹ï¼‰
![1766559088885](image/2.ros_experiment/1766559088885.png)

**è§‚å¯Ÿåˆ°** ï¼šController å‘é€é€Ÿåº¦æŒ‡ä»¤ï¼ŒMotor æ¥æ”¶å¹¶æ›´æ–°ä½ç½®ã€‚

---

ä½†æ˜¯ï¼Œå¦‚æœæ¯å¯åŠ¨ä¸€ä¸ªç¨‹åºéƒ½è¾“å…¥ä¸€è¡ŒæŒ‡ä»¤ä¸ä¼šå¤ªå¤æ‚äº†å—ï¼Ÿ

ROSæ¡†æ¶ä¸­ä¹Ÿæœ‰è‡ªå·±çš„â€œè„šæœ¬â€ï¼Œå¯ä»¥ä¸€é”®å¯åŠ¨å¤šä¸ªç»“ç‚¹ã€‚

å…³é—­ç»ˆç«¯2å’Œç»ˆç«¯3ï¼Œåœ¨ç»ˆç«¯3ä¸­æ‰§è¡Œï¼š

```bash
cd ~/catkin_ws
source devel/setup.bash
roslaunch ros_course_examples ros_communication_demo.launch
```

ä½ å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œè¿™ä¸¤ä¸ªç»“ç‚¹éƒ½å·²ç»å¯åŠ¨äº†ã€‚

![1766559251701](image/2.ros_experiment/1766559251701.png)

#### å®éªŒ 2.3ï¼šTurtleSim é€šä¿¡å®éªŒ

å¯ä»¥å…³é—­è¿™ä¸ªç¨‹åºäº†ï¼ˆ**æ³¨æ„ä¸è¦å…³é—­roscoreçš„ç»ˆç«¯**ï¼‰

ç»ˆç«¯ 2ï¼šå¯åŠ¨ Turtle ä»¿çœŸ

```bash
rosrun turtlesim turtlesim_node

```

![1766559377818](image/2.ros_experiment/1766559377818.png)

ç»ˆç«¯ 3ï¼šå¯åŠ¨é”®ç›˜æ§åˆ¶

```bash
rosrun turtlesim turtle_teleop_key
```

![1766559474890](image/2.ros_experiment/1766559474890.png)

åœ¨ç»ˆç«¯3ä¸­æŒ‰ä¸‹æ–¹å‘é”®å¯ä»¥æ§åˆ¶turtleè¿åŠ¨ã€‚
![1766559507381](image/2.ros_experiment/1766559507381.png)

ç»ˆç«¯ 4ï¼šå¯è§†åŒ–é€šä¿¡å›¾

```bash
rqt_graph
```

![1766559792210](image/2.ros_experiment/1766559792210.png)

**é€šä¿¡æµç¨‹åˆ†æ** ï¼š

1. `turtle_teleop_key` èŠ‚ç‚¹ç›‘å¬é”®ç›˜è¾“å…¥
2. å‘å¸ƒé€Ÿåº¦å‘½ä»¤åˆ° `/turtle1/cmd_vel` è¯é¢˜
3. å‘å¸ƒåˆ°è¯é¢˜ä¸­çš„ä¿¡æ¯å°±æ˜¯çº¿é€Ÿåº¦å’Œè§’é€Ÿåº¦ï¼Œæ¶ˆæ¯çš„ç±»å‹æ˜¯ `geometry_msgs/Twist`
4. `turtlesim_node` è®¢é˜… `/turtle1/cmd_vel`
5. æ¥æ”¶é€Ÿåº¦å‘½ä»¤å¹¶æ‰§è¡Œè¿åŠ¨

#### å®éªŒ 2.4ï¼šæŸ¥çœ‹è¯é¢˜ä¿¡æ¯

ä»¥ä¸Šè¿™äº›ä¿¡æ¯éƒ½å¯ä»¥é€šè¿‡rosæŒ‡ä»¤æ¥è§‚å¯Ÿåˆ°ã€‚

```bash
# åˆ—å‡ºæ‰€æœ‰è¯é¢˜
rostopic list
```

```bash
# æŸ¥çœ‹è¯é¢˜ä¿¡æ¯
rostopic info /turtle1/cmd_vel
```

```bash
# æŸ¥çœ‹æ¶ˆæ¯ç±»å‹å®šä¹‰
rosmsg show geometry_msgs/Twist
```

![1766560209464](image/2.ros_experiment/1766560209464.png)

```bash
# æŸ¥çœ‹è¯é¢˜æ•°æ®
rostopic echo /turtle1/cmd_vel
```

![1766559946201](image/2.ros_experiment/1766559946201.png)

#### å®éªŒ 2.5ï¼šæ ‡å‡† ROS é€šä¿¡ç¤ºä¾‹


é¦–å…ˆç»™è„šæœ¬é™„ä¸Šæ‰§è¡Œæƒé™ã€‚

```bash
cd ~/catkin_ws
cd src/ros_course_examples/scripts/
chmod +x run_basic_demo.sh
```



```bash
cd ~/catkin_ws
source devel/setup.bash
rosrun ros_course_examples run_basic_demo.sh
```

 **è§‚å¯Ÿå†…å®¹** ï¼š

* Talker/Listenerï¼šå­—ç¬¦ä¸²æ¶ˆæ¯ä¼ é€’
* Image Publisherï¼šå›¾åƒæ•°æ®ä¼ è¾“ï¼ˆåœ¨ RViz ä¸­æŸ¥çœ‹ï¼‰
* Add Two Ints Serviceï¼šæœåŠ¡è°ƒç”¨ç¤ºä¾‹

 **æ‰‹åŠ¨è°ƒç”¨æœåŠ¡** ï¼š

```bash
source devel/setup.bash
rosrun ros_course_examples add_two_ints_client.py 10 20
```

### 4. å…³é”®ä»£ç è§£æ

#### 4.1 è¯é¢˜å‘å¸ƒè€…

```bash
from std_msgs.msg import String

# åˆå§‹åŒ–èŠ‚ç‚¹
rospy.init_node('talker', anonymous=True)

# åˆ›å»ºå‘å¸ƒè€…
pub = rospy.Publisher('chatter', String, queue_size=10)

# è®¾ç½®é¢‘ç‡ 10Hz
rate = rospy.Rate(10)

while not rospy.is_shutdown():
    msg = "Hello ROS world"
    pub.publish(msg)
    rate.sleep()
```

#### 4.2 è¯é¢˜è®¢é˜…è€…

```bashpython</span></div><code
from std_msgs.msg import String

def callback(msg):
    rospy.loginfo("I heard: %s", msg.data)

# åˆå§‹åŒ–èŠ‚ç‚¹
rospy.init_node('listener', anonymous=True)

# åˆ›å»ºè®¢é˜…è€…
rospy.Subscriber('chatter', String, callback)

rospy.spin()  # ä¿æŒèŠ‚ç‚¹è¿è¡Œ
```

#### 4.3 å›¾åƒå‘å¸ƒï¼ˆæ˜“é”™ç‚¹ï¼‰

```bashpython</span></div><code
import cv2

bridge = CvBridge()

# OpenCV å›¾åƒè½¬ ROS æ¶ˆæ¯
# æ³¨æ„ï¼šOpenCV é»˜è®¤ BGRï¼Œéœ€æ­£ç¡®æŒ‡å®šç¼–ç 
ros_image = bridge.cv2_to_imgmsg(img, encoding="bgr8")
image_pub.publish(ros_image)
```

âš ï¸  **å¸¸è§é”™è¯¯** ï¼šç¼–ç å‚æ•°é”™è¯¯å¯¼è‡´é¢œè‰²åè½¬ã€‚

---

## å®éªŒä¸‰ï¼šGazebo ä»¿çœŸç¯å¢ƒ

### 1. å®éªŒç›®çš„

* æŒæ¡ Gazebo ä»¿çœŸå™¨çš„ä½¿ç”¨
* å­¦ä¼šåŠ è½½å’Œä¿å­˜ä»¿çœŸä¸–ç•Œ
* ç†è§£ World æ–‡ä»¶ç»“æ„
* æŒæ¡æœºå™¨äººæ¨¡å‹çš„åŠ è½½

### 2. Gazebo æ ¸å¿ƒåŠŸèƒ½

* **ç‰©ç†å¼•æ“** ï¼šæ¨¡æ‹ŸçœŸå®ç‰©ç†è§„å¾‹ï¼ˆé‡åŠ›ã€ç¢°æ’ã€æ‘©æ“¦ï¼‰
* **ä¼ æ„Ÿå™¨ä»¿çœŸ** ï¼šæ¿€å…‰é›·è¾¾ã€ç›¸æœºã€IMU ç­‰
* **ROS é›†æˆ** ï¼šä¸ ROS æ— ç¼é€šä¿¡
* **å¯è§†åŒ–** ï¼š3D åœºæ™¯æ¸²æŸ“

### 3. å®éªŒæ­¥éª¤

#### 3.1 å¯åŠ¨ç©ºç™½ä¸–ç•Œ

```bash#
gazebo

# æˆ–ä½¿ç”¨ ROS å¯åŠ¨
roslaunch turtlebot3_gazebo turtlebot3_empty_world.launch
```

#### 3.2 æ„å»ºè‡ªå®šä¹‰åœºæ™¯

1. **æ’å…¥æ¨¡å‹** ï¼šä»å·¦ä¾§é¢æ¿æ‹–æ‹½ç‰©ä½“åˆ°åœºæ™¯
2. **è°ƒæ•´å‚æ•°** ï¼š

* Position (x, y, z)ï¼šä½ç½®åæ ‡
* Orientation (roll, pitch, yaw)ï¼šå§¿æ€è§’åº¦
* Scaleï¼šç¼©æ”¾å¤§å°

1. **ä¿å­˜ä¸–ç•Œ** ï¼š`File â†’ Save World As â†’ my_world.world`

#### 3.3 åŠ è½½è‡ªå®šä¹‰ä¸–ç•Œ

```bash#
gazebo my_world.world

# æ–¹æ³• 2ï¼šROS launch æ–‡ä»¶
roslaunch turtlebot3_gazebo turtlebot3_world.launch
```

#### 3.4 æ§åˆ¶æœºå™¨äººè¿åŠ¨

```bash#
roslaunch turtlebot3_teleop turtlebot3_teleop_key.launch
```

 **æ“ä½œè¯´æ˜** ï¼š

* `W/A/S/D` æˆ– `æ–¹å‘é”®`ï¼šæ§åˆ¶ç§»åŠ¨
* `X`ï¼šåœæ­¢
* `Q/Z`ï¼šå¢åŠ /å‡å°‘é€Ÿåº¦

---

## å®éªŒå››ï¼šTurtleBot3 è¿åŠ¨æ§åˆ¶

### 1. å®éªŒç›®çš„

* æŒæ¡é€šè¿‡ä»£ç æ§åˆ¶ç§»åŠ¨æœºå™¨äºº
* ç†è§£çº¿é€Ÿåº¦å’Œè§’é€Ÿåº¦çš„å…³ç³»
* å­¦ä¹ é‡Œç¨‹è®¡ï¼ˆOdometryï¼‰æ•°æ®å¤„ç†
* ç†è§£å››å…ƒæ•°ä¸æ¬§æ‹‰è§’è½¬æ¢

### 2. è¿åŠ¨æ§åˆ¶åŸç†

#### 2.1 é€Ÿåº¦å‘½ä»¤æ¶ˆæ¯

```bashpython</span></div><code

twist = Twist()
twist.linear.x = 0.2   # å‰åé€Ÿåº¦ (m/s)
twist.linear.y = 0.0   # å·¦å³é€Ÿåº¦ï¼ˆå·®é€Ÿæœºå™¨äººé€šå¸¸ä¸º0ï¼‰
twist.angular.z = 0.5  # æ—‹è½¬é€Ÿåº¦ (rad/s)

cmd_vel_pub.publish(twist)
```

#### 2.2 é‡Œç¨‹è®¡æ•°æ®è®¢é˜…

```bashpython</span></div><code

def odom_callback(msg):
    # è·å–ä½ç½®
    x = msg.pose.pose.position.x
    y = msg.pose.pose.position.y
  
    # è·å–å§¿æ€ï¼ˆå››å…ƒæ•°ï¼‰
    orientation = msg.pose.pose.orientation
```

### 3. å®éªŒæ­¥éª¤

#### 3.1 å¯åŠ¨å½¢çŠ¶è¿åŠ¨æ¼”ç¤º

```bashrosrun

```

 **é€‰æ‹©è¿åŠ¨æ¨¡å¼** ï¼š

* `1`ï¼šåœ†å½¢è½¨è¿¹
* `2`ï¼šæ­£æ–¹å½¢è½¨è¿¹
* `3`ï¼šé•¿æ–¹å½¢è½¨è¿¹

#### 3.2 è§‚å¯Ÿè¿åŠ¨æ•ˆæœ

* Gazeboï¼šæŸ¥çœ‹æœºå™¨äººå®é™…è¿åŠ¨
* RVizï¼šè§‚å¯Ÿä¼ æ„Ÿå™¨æ•°æ®å’Œåæ ‡å˜æ¢

### 4. å…³é”®ä»£ç è§£æ

#### 4.1 æ­£æ–¹å½¢è¿åŠ¨

```bashpython</span></div><code
    side_length = 1.0
    for _ in range(4):
        self.go_straight(side_length)  # ç›´è¡Œ1ç±³
        self.turn_90_degrees()         # è½¬90åº¦
```

#### 4.2 å››å…ƒæ•°è½¬æ¬§æ‹‰è§’ï¼ˆé‡ç‚¹ï¼‰

```bashpython</span></div><code

def odom_callback(self, msg):
    # æå–å››å…ƒæ•°
    quaternion = (
        msg.pose.pose.orientation.x,
        msg.pose.pose.orientation.y,
        msg.pose.pose.orientation.z,
        msg.pose.pose.orientation.w
    )
  
    # è½¬æ¢ä¸ºæ¬§æ‹‰è§’
    (roll, pitch, yaw) = tf.transformations.euler_from_quaternion(quaternion)
  
    # yaw æ˜¯å¹³é¢æœºå™¨äººçš„èˆªå‘è§’
    self.current_theta = yaw
```

âš ï¸  **æ³¨æ„äº‹é¡¹** ï¼š

* è§’åº¦èŒƒå›´ï¼š`-Ï€` åˆ° `Ï€` æˆ– `0` åˆ° `2Ï€`
* å¤„ç†è§’åº¦è·³å˜ï¼ˆä» `Ï€` åˆ° `-Ï€`ï¼‰
* å¼€ç¯æ§åˆ¶ä¼šæœ‰ç´¯ç§¯è¯¯å·®

---

## å®éªŒäº”ï¼šRViz å¯è§†åŒ–

### 1. å®éªŒç›®çš„

* æŒæ¡ RViz å¯è§†åŒ–å·¥å…·çš„ä½¿ç”¨
* å­¦ä¼šæ·»åŠ å’Œé…ç½®æ˜¾ç¤ºé¡¹
* ç†è§£ä¼ æ„Ÿå™¨æ•°æ®çš„å¯è§†åŒ–è¡¨ç¤º
* æŒæ¡ç•Œé¢äº¤äº’å’Œè§†è§’æ§åˆ¶

### 2. RViz å¯æ˜¾ç¤ºçš„æ•°æ®ç±»å‹

* **Robot Model** ï¼š3D æœºå™¨äººæ¨¡å‹
* **LaserScan** ï¼šæ¿€å…‰é›·è¾¾æ‰«ææ•°æ®
* **PointCloud2** ï¼š3D ç‚¹äº‘æ•°æ®
* **TF** ï¼šåæ ‡ç³»å˜æ¢å…³ç³»
* **Image** ï¼šç›¸æœºå›¾åƒ
* **Odometry** ï¼šé‡Œç¨‹è®¡è½¨è¿¹
* **Path** ï¼šè§„åˆ’è·¯å¾„
* **Map** ï¼šå æ®æ …æ ¼åœ°å›¾

### 3. RViz å¯åŠ¨æ–¹å¼

#### æ–¹æ³•1ï¼šç›´æ¥å¯åŠ¨ï¼ˆéœ€è¦å…ˆè¿è¡Œ roscoreï¼‰

```bashrviz

```

#### æ–¹æ³•2ï¼šä½¿ç”¨ TurtleBot3 é…ç½®å¯åŠ¨ï¼ˆæ¨èï¼‰

```bashroslaunch

```

#### æ–¹æ³•3ï¼šåŠ è½½è‡ªå®šä¹‰é…ç½®æ–‡ä»¶

```bashrviz

```

### 4. å®éªŒæ­¥éª¤

#### 4.1 å¯åŠ¨ä»¿çœŸå’Œå¯è§†åŒ–

```bash#
roslaunch turtlebot3_gazebo turtlebot3_world.launch

# ç»ˆç«¯ 2ï¼šå¯åŠ¨ RViz
roslaunch turtlebot3_rviz_launchers view_robot.launch
```

#### 4.2 RViz ç•Œé¢åŸºç¡€æ“ä½œ

##### **è§†è§’æ§åˆ¶ï¼ˆé‡è¦ï¼‰**

* ğŸ–±ï¸  **é¼ æ ‡å·¦é”®æ‹–æ‹½** ï¼šæ—‹è½¬è§†è§’
* ğŸ–±ï¸  **é¼ æ ‡æ»šè½®** ï¼šç¼©æ”¾è§†å›¾
* ğŸ–±ï¸  **Shift + å·¦é”®æ‹–æ‹½** ï¼šå¹³ç§»è§†å›¾
* ğŸ–±ï¸  **Shift + æ»šè½®** ï¼šä¸Šä¸‹å¹³ç§»
* ğŸ–±ï¸  **é¼ æ ‡ä¸­é”®æ‹–æ‹½** ï¼šå¹³ç§»ï¼ˆæŸäº›ç³»ç»Ÿï¼‰

##### **ç•Œé¢å¸ƒå±€è¯´æ˜**

```bash</span></div><code
â”‚  èœå•æ  (File / View / Panels)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          â”‚                      â”‚        â”‚
â”‚ Displays â”‚   3D è§†å›¾çª—å£         â”‚ å·¥å…·æ   â”‚
â”‚ é¢æ¿     â”‚   (ä¸»æ˜¾ç¤ºåŒºåŸŸ)        â”‚ Views  â”‚
â”‚          â”‚                      â”‚ Time   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.3 æ·»åŠ æ˜¾ç¤ºé¡¹ï¼ˆDisplayï¼‰è¯¦ç»†æ­¥éª¤

##### **ç¤ºä¾‹1ï¼šæ·»åŠ æ¿€å…‰é›·è¾¾æ•°æ®**

1. ç‚¹å‡»å·¦ä¸‹è§’ **"Add"** æŒ‰é’®
2. åœ¨å¼¹å‡ºçª—å£ä¸­é€‰æ‹© **"By display type"** æ ‡ç­¾
3. æ‰¾åˆ°å¹¶åŒå‡» **"LaserScan"**
4. åœ¨å·¦ä¾§ Displays é¢æ¿ä¸­å±•å¼€ **"LaserScan"**
5. é…ç½®å‚æ•°ï¼š
   ```bash</span></div><code
   Topic: /scan           # ç‚¹å‡»ä¸‹æ‹‰é€‰æ‹© /scan
   Size (m): 0.05         # è°ƒæ•´ç‚¹çš„å¤§å°
   Style: Points          # æ˜¾ç¤ºæ ·å¼
   Color Transformer: Intensity  # é¢œè‰²æ˜ å°„
   ```
6. è§‚å¯Ÿçº¢è‰²æ‰«æç‚¹æ˜¾ç¤ºéšœç¢ç‰©ä½ç½®

##### **ç¤ºä¾‹2ï¼šæ·»åŠ é‡Œç¨‹è®¡è½¨è¿¹**

1. ç‚¹å‡» **"Add"** â†’ é€‰æ‹© **"Odometry"**
2. é…ç½®å‚æ•°ï¼š
   ```bash</span></div><code
   Keep: 100              # ä¿ç•™ 100 æ¡å†å²è½¨è¿¹
   Shape: Arrow           # æ˜¾ç¤ºä¸ºç®­å¤´
   Color: 0; 0; 255       # è“è‰² (RGB)
   Alpha: 1.0             # ä¸é€æ˜åº¦
   Shaft Length: 0.3      # ç®­å¤´é•¿åº¦
   ```
3. æœºå™¨äººç§»åŠ¨æ—¶ä¼šæ˜¾ç¤ºè“è‰²è½¨è¿¹çº¿

##### **ç¤ºä¾‹3ï¼šæ·»åŠ åæ ‡ç³»ï¼ˆTFï¼‰**

1. ç‚¹å‡» **"Add"** â†’ é€‰æ‹© **"TF"**
2. é…ç½®å‚æ•°ï¼š
   ```bash</span></div><code
   âœ“ Show Axes           # æ˜¾ç¤ºåæ ‡è½´
   âœ“ Show Arrows         # æ˜¾ç¤ºç®­å¤´
   Marker Scale: 0.5     # è°ƒæ•´åæ ‡è½´å¤§å°
   Update Interval: 0    # æ›´æ–°é¢‘ç‡ï¼ˆ0=æœ€å¿«ï¼‰
   ```
3. è§‚å¯Ÿçº¢ç»¿è“ç®­å¤´ï¼ˆä»£è¡¨ X/Y/Z è½´ï¼‰

#### 4.4 å¸¸ç”¨æ˜¾ç¤ºé¡¹é…ç½®è¡¨

| æ˜¾ç¤ºç±»å‹             | æ¨èè¯é¢˜                   | ä½œç”¨             | å…³é”®å‚æ•°                                  |
| -------------------- | -------------------------- | ---------------- | ----------------------------------------- |
| **RobotModel** | (é»˜è®¤)                     | æ˜¾ç¤ºæœºå™¨äºº3Dæ¨¡å‹ | `Robot Description: robot_description`  |
| **LaserScan**  | `/scan`                  | æ¿€å…‰é›·è¾¾æ‰«ææ•°æ® | `Size: 0.05`, `Style: Points`         |
| **Odometry**   | `/odom`                  | é‡Œç¨‹è®¡è½¨è¿¹       | `Keep: 100`, `Shape: Arrow`           |
| **Path**       | `/move_base/global_plan` | å…¨å±€è§„åˆ’è·¯å¾„     | `Color: 255;255;0` (é»„è‰²)               |
| **TF**         | (æ— éœ€è®¾ç½®)                 | åæ ‡ç³»å…³ç³»       | `Show Names: âœ“`, `Marker Scale: 0.5` |
| **Image**      | `/camera/rgb/image_raw`  | ç›¸æœºå›¾åƒ         | `Transport Hint: raw`                   |
| **Map**        | `/map`                   | å æ®æ …æ ¼åœ°å›¾     | `Color Scheme: map`                     |

#### 4.5 è°ƒæ•´ Fixed Frameï¼ˆå‚è€ƒåæ ‡ç³»ï¼‰

**ä»€ä¹ˆæ˜¯ Fixed Frameï¼Ÿ**

* RViz ä¸­æ‰€æœ‰æ•°æ®çš„æ˜¾ç¤ºéƒ½éœ€è¦ä¸€ä¸ªå‚è€ƒåæ ‡ç³»
* ä¸åŒåœºæ™¯éœ€è¦é€‰æ‹©ä¸åŒçš„ Fixed Frame

**é€‰æ‹©å»ºè®®**

| åœºæ™¯           | Fixed Frame   | æ•ˆæœ               |
| -------------- | ------------- | ------------------ |
| è§‚å¯Ÿæœºå™¨äººè¿åŠ¨ | `odom`      | è§†è§’è·Ÿéšæœºå™¨äºº     |
| æŸ¥çœ‹å…¨å±€åœ°å›¾   | `map`       | å›ºå®šä¸åŠ¨çš„ä¸–ç•Œè§†è§’ |
| è°ƒè¯•ä¼ æ„Ÿå™¨     | `base_link` | è§†è§’é”å®šåœ¨æœºå™¨äººä¸Š |

**è®¾ç½®æ–¹æ³•**

1. åœ¨é¡¶éƒ¨ **"Global Options"** å±•å¼€
2. ç‚¹å‡» **"Fixed Frame"** ä¸‹æ‹‰èœå•
3. é€‰æ‹© `odom` æˆ– `map`

âš ï¸  **æ³¨æ„** ï¼šå¦‚æœ Fixed Frame è®¾ç½®é”™è¯¯ï¼Œæ‰€æœ‰æ˜¾ç¤ºé¡¹ä¼šå˜ç°è‰²æˆ–ä¸æ˜¾ç¤ºã€‚

#### 4.6 è§‚å¯Ÿè¿åŠ¨æ•ˆæœçš„å®Œæ•´æµç¨‹

**æ­¥éª¤1ï¼šå‡†å¤‡ç¯å¢ƒ**

```bash#
roslaunch turtlebot3_gazebo turtlebot3_world.launch

# ç»ˆç«¯ 2ï¼šå¯åŠ¨ RViz
roslaunch turtlebot3_rviz_launchers view_robot.launch

# ç»ˆç«¯ 3ï¼šè¿è¡Œå½¢çŠ¶è¿åŠ¨
rosrun ros_course_examples run_shape_demo.sh
```

**æ­¥éª¤2ï¼šåœ¨ RViz ä¸­é…ç½®æ˜¾ç¤º**

1. ç¡®è®¤ Fixed Frame ä¸º `odom`
2. æ·»åŠ   **Odometry** ï¼Œå‹¾é€‰ **Keep**
3. æ·»åŠ  **LaserScan**
4. æ·»åŠ  **TF**

**æ­¥éª¤3ï¼šè§‚å¯Ÿåˆ†æ**

* **Gazebo** ï¼šçœ‹æœºå™¨äººå®é™…è¿åŠ¨ï¼ˆçœŸå®ç‰©ç†è¡¨ç°ï¼‰
* **RViz** ï¼šçœ‹ä¼ æ„Ÿå™¨æ•°æ®å’Œåæ ‡ç³»å˜æ¢ï¼ˆæ•°æ®å±‚é¢ï¼‰
* å¯¹æ¯”ä¸¤è€…ï¼Œç†è§£ä¼ æ„Ÿå™¨æ•°æ®ä¸çœŸå®ç¯å¢ƒçš„å…³ç³»

#### 4.7 ä¿å­˜å’ŒåŠ è½½é…ç½®

**ä¿å­˜é…ç½®æ–‡ä»¶**

```bash</span></div><code
2. File â†’ Save Config As
3. å‘½åï¼šmy_turtlebot_config.rviz
4. ä¿å­˜åˆ°ï¼š~/catkin_ws/rviz_configs/
```

**ä¸‹æ¬¡ä½¿ç”¨**

```bashrviz

```

**åœ¨ launch æ–‡ä»¶ä¸­ä½¿ç”¨**

```bashxml</span></div><code

```

#### 4.8 æŸ¥çœ‹ TF æ ‘

**æ–¹æ³•1ï¼šåœ¨ RViz ä¸­æŸ¥çœ‹**

* æ·»åŠ  TF æ˜¾ç¤ºé¡¹
* å‹¾é€‰ "Show Names" å’Œ "Show Axes"
* è§‚å¯Ÿåæ ‡ç³»ä¹‹é—´çš„å±‚çº§å…³ç³»

**æ–¹æ³•2ï¼šç”Ÿæˆ TF æ ‘å›¾ï¼ˆæ¨èï¼‰**

```bash#
rosrun tf2_tools view_frames.py

# ç­‰å¾… 5 ç§’åè‡ªåŠ¨ç”Ÿæˆ frames.pdf
evince frames.pdf  # æˆ–ç”¨å…¶ä»– PDF é˜…è¯»å™¨æ‰“å¼€
```

**TF æ ‘ç»“æ„ç¤ºä¾‹**

```bash</span></div><code
 â””â”€ odom
     â””â”€ base_footprint
         â””â”€ base_link
             â”œâ”€ camera_link
             â”‚   â””â”€ camera_rgb_frame
             â”œâ”€ imu_link
             â””â”€ base_scan (laser_link)
```

#### 4.9 ç›‘æ§è¯é¢˜æ•°æ®

**æŸ¥çœ‹æ¿€å…‰æ‰«ææ•°æ®**

```bashrostopic

```

**æŸ¥çœ‹é‡Œç¨‹è®¡æ•°æ®**

```bashrostopic

```

**æŸ¥çœ‹ TF å˜æ¢**

```bash#
rosrun tf tf_echo map base_link
```

**æŸ¥çœ‹è¯é¢˜å‘å¸ƒé¢‘ç‡**

```bashrostopic
rostopic hz /odom
```

### 5. RViz å®ç”¨æŠ€å·§

#### 5.1 æ€§èƒ½ä¼˜åŒ–

* å¦‚æœ RViz å¡é¡¿ï¼Œå‡å°‘ **Keep** å€¼ï¼ˆå†å²æ•°æ®é‡ï¼‰
* é™ä½ç‚¹äº‘çš„ **Size** å’Œ **Alpha**
* ç¦ç”¨ä¸éœ€è¦çš„æ˜¾ç¤ºé¡¹

#### 5.2 è°ƒè¯•æŠ€å·§

* ä½¿ç”¨ **Marker Scale** è°ƒæ•´åæ ‡è½´å¤§å°ï¼Œæ–¹ä¾¿è§‚å¯Ÿå°ç‰©ä½“
* ä½¿ç”¨ **Color** åŒºåˆ†ä¸åŒæ•°æ®æº
* ä½¿ç”¨ **Topic** ä¸‹æ‹‰èœå•ç¡®è®¤æ•°æ®æ˜¯å¦åœ¨å‘å¸ƒ

#### 5.3 å¤šçª—å£å¸ƒå±€

```bash</span></div><code
View â†’ Camera Type â†’ Top Down Orthographic  # ä¿¯è§†å›¾
```

### 6. å¸¸è§é—®é¢˜æ’æŸ¥

| é—®é¢˜                      | åŸå›              | è§£å†³æ–¹æ³•                           |
| ------------------------- | ---------------- | ---------------------------------- |
| âŒ æ˜¾ç¤ºé¡¹å˜çº¢è‰²/ç°è‰²      | è¯é¢˜æœªå‘å¸ƒ       | `rostopic list` æ£€æŸ¥è¯é¢˜æ˜¯å¦å­˜åœ¨ |
| âŒ çœ‹ä¸åˆ°æœºå™¨äººæ¨¡å‹       | Fixed Frame é”™è¯¯ | æ”¹ä¸º `odom` æˆ– `base_link`     |
| âŒ æ¿€å…‰æ•°æ®ä¸æ˜¾ç¤º         | Topic é€‰æ‹©é”™è¯¯   | ç¡®è®¤ä¸º `/scan`                   |
| âŒ TF æ˜¾ç¤º "No transform" | TF æ ‘ä¸å®Œæ•´      | æ£€æŸ¥ `rosrun tf view_frames`     |
| âŒ RViz é—ªé€€              | é…ç½®æ–‡ä»¶æŸå     | åˆ é™¤ `~/.rviz/default.rviz` é‡å¯ |

### 7. è¯¾åç»ƒä¹ 

1. **åŸºç¡€æ“ä½œ**
   * å¯åŠ¨ TurtleBot3 ä»¿çœŸï¼Œåœ¨ RViz ä¸­æ·»åŠ æ‰€æœ‰ä¼ æ„Ÿå™¨æ•°æ®
   * ä¿å­˜é…ç½®æ–‡ä»¶å¹¶éªŒè¯ä¸‹æ¬¡èƒ½æ­£å¸¸åŠ è½½
2. **æ•°æ®åˆ†æ**
   * æ§åˆ¶æœºå™¨äººèµ°æ­£æ–¹å½¢ï¼Œè§‚å¯Ÿ Odometry è½¨è¿¹æ˜¯å¦å‡†ç¡®
   * å¯¹æ¯” Gazebo ä¸­çš„å®é™…è·¯å¾„å’Œ RViz ä¸­çš„é‡Œç¨‹è®¡è½¨è¿¹
3. **TF ç†è§£**
   * ç”Ÿæˆ TF æ ‘å›¾ï¼Œç†è§£æ¯ä¸ªåæ ‡ç³»çš„ä½œç”¨
   * ä½¿ç”¨ `tf_echo` å®æ—¶æŸ¥çœ‹ `odom` åˆ° `base_link` çš„å˜æ¢
4. **è¿›é˜¶æŒ‘æˆ˜**
   * å°è¯•è°ƒæ•´ LaserScan çš„é¢œè‰²æ˜ å°„æ–¹å¼
   * æ·»åŠ å¤šä¸ª Odometry æ˜¾ç¤ºé¡¹ï¼Œç”¨ä¸åŒé¢œè‰²å¯¹æ¯”ä¸åŒæ•°æ®æº

---

## å®éªŒå…­ï¼šåæ ‡ç³»ä¸ TF å˜æ¢

### 1. å®éªŒç›®çš„

* ç†è§£æœºå™¨äººç³»ç»Ÿä¸­çš„å¤šåæ ‡ç³»æ¦‚å¿µ
* æŒæ¡ TFï¼ˆTransformï¼‰å˜æ¢çš„ä½œç”¨
* å­¦ä¼šæŸ¥çœ‹å’Œåˆ†æ TF æ ‘

### 2. ä¸ºä»€ä¹ˆéœ€è¦å¤šåæ ‡ç³»ï¼Ÿ

#### 2.1 å¸¸è§åæ ‡ç³»

* **map** ï¼šå…¨å±€åœ°å›¾åæ ‡ç³»ï¼ˆå›ºå®šï¼‰
* **odom** ï¼šé‡Œç¨‹è®¡åæ ‡ç³»ï¼ˆç›¸å¯¹å›ºå®šï¼Œæœ‰æ¼‚ç§»ï¼‰
* **base_link/base_footprint** ï¼šæœºå™¨äººåº•ç›˜ä¸­å¿ƒ
* **laser_link/camera_link** ï¼šä¼ æ„Ÿå™¨åæ ‡ç³»

#### 2.2 ä½¿ç”¨åœºæ™¯

| åœºæ™¯       | éœ€æ±‚                                 | è§£å†³æ–¹æ¡ˆ                 |
| ---------- | ------------------------------------ | ------------------------ |
| æœºå™¨äººå®šä½ | çŸ¥é“æœºå™¨äººåœ¨åœ°å›¾ä¸­çš„ä½ç½®             | map â†’ base_link         |
| ä¼ æ„Ÿå™¨èåˆ | å°†ä¸åŒä¼ æ„Ÿå™¨æ•°æ®ç»Ÿä¸€åˆ°åŒä¸€åæ ‡ç³»     | TF å˜æ¢                  |
| ç›®æ ‡è·Ÿè¸ª   | å°†æ£€æµ‹åˆ°çš„ç‰©ä½“ä½ç½®è½¬æ¢åˆ°æœºå™¨äººåæ ‡ç³» | camera_link â†’ base_link |

### 3. å®éªŒæ­¥éª¤

#### 3.1 å¯è§†åŒ– TF æ ‘

åœ¨ RViz ä¸­ï¼š

1. æ·»åŠ  `TF` æ˜¾ç¤ºé¡¹
2. è§‚å¯Ÿçº¢ç»¿è“ç®­å¤´ï¼ˆä»£è¡¨ X/Y/Z è½´ï¼‰
3. æŸ¥çœ‹åæ ‡ç³»ä¹‹é—´çš„è¿æ¥å…³ç³»

#### 3.2 æŸ¥è¯¢ TF å˜æ¢

```bash#
rosrun tf tf_echo odom base_link

# è¾“å‡ºç¤ºä¾‹ï¼š
# Translation: [x, y, z]
# Rotation: [x, y, z, w] (å››å…ƒæ•°)
```

#### 3.3 ç”Ÿæˆ TF æ ‘å›¾

```bashrosrun
evince frames.pdf
```

### 4. TF å˜æ¢ä»£ç ç¤ºä¾‹

```bashpython</span></div><code

# åˆ›å»º TF ç›‘å¬å™¨
listener = tf.TransformListener()

# ç­‰å¾…å˜æ¢å¯ç”¨
listener.waitForTransform('/map', '/base_link', rospy.Time(), rospy.Duration(4.0))

# æŸ¥è¯¢å˜æ¢
try:
    (trans, rot) = listener.lookupTransform('/map', '/base_link', rospy.Time(0))
    print("Translation:", trans)
    print("Rotation:", rot)
except (tf.LookupException, tf.ConnectivityException):
    print("TF lookup failed")
```

---

## å®éªŒä¸ƒï¼šå¤šæœºååŒæ¸¸æˆï¼ˆè¿›é˜¶ï¼‰

### 1. å®éªŒç›®çš„

* ç†è§£ ROS å¤šæœºé€šä¿¡æœºåˆ¶
* æŒæ¡ `ROS_MASTER_URI` å’Œ `ROS_IP` é…ç½®
* ä½“éªŒåˆ†å¸ƒå¼æœºå™¨äººç³»ç»Ÿ

### 2. ç‰ˆæœ¬ä¸€ï¼šå•æœºåŒæ§

```bashrosrun

```

* ç©å®¶1ï¼š`W/A/S/D`
* ç©å®¶2ï¼š`æ–¹å‘é”®`

### 3. ç‰ˆæœ¬äºŒï¼šå¤šæœºè”è°ƒ

#### ä¸»æœºé…ç½®ï¼ˆè¿è¡Œ roscore å’Œ Gazeboï¼‰

```bashsource
roslaunch ros_course_examples multi_turtlebot_game.launch
```

#### ä»æœºé…ç½®ï¼ˆè¿è¡Œæ§åˆ¶èŠ‚ç‚¹ï¼‰

```bash#
source src/ros_course_examples/scripts/setup_slave.sh 192.168.1.100
rosrun ros_course_examples dual_teleop.py
```

#### ç½‘ç»œé…ç½®è¦ç‚¹

```bash#
export ROS_MASTER_URI=http://localhost:11311
export ROS_IP=192.168.1.100  # ä¸»æœºå®é™…IP

# ä»æœºç¯å¢ƒå˜é‡
export ROS_MASTER_URI=http://192.168.1.100:11311
export ROS_IP=192.168.1.101  # ä»æœºå®é™…IP
```

---

## æ€»ç»“ä¸å»ºè®®

### å­¦ä¹ è·¯å¾„

1. âœ… Linux åŸºç¡€ â†’ ç†Ÿç»ƒä½¿ç”¨ç»ˆç«¯
2. âœ… ROS é€šä¿¡ â†’ ç†è§£èŠ‚ç‚¹ã€è¯é¢˜ã€æœåŠ¡
3. âœ… Gazebo ä»¿çœŸ â†’ æ­å»ºæµ‹è¯•ç¯å¢ƒ
4. âœ… RViz å¯è§†åŒ– â†’ æŸ¥çœ‹ä¼ æ„Ÿå™¨æ•°æ®
5. âœ… TF åæ ‡ç³» â†’ ç†è§£ç©ºé—´å…³ç³»
6. âœ… è¿åŠ¨æ§åˆ¶ â†’ ç¼–å†™æ§åˆ¶ä»£ç 

### è¯¾åç»ƒä¹ å»ºè®®

* å¤šç»ƒä¹  Linux å‘½ä»¤è¡Œæ“ä½œ
* å°è¯•ä¿®æ”¹ç¤ºä¾‹ä»£ç å‚æ•°ï¼Œè§‚å¯Ÿæ•ˆæœ
* ä½¿ç”¨ `rqt_graph` å’Œ `rostopic` å·¥å…·åˆ†æç³»ç»Ÿ
* é˜…è¯» ROS Wiki å®˜æ–¹æ–‡æ¡£

### æ¨èèµ„æº

* [ROS Wiki](http://wiki.ros.org/)
* [Gazebo Tutorials](http://gazebosim.org/tutorials)
* [TF Tutorials](http://wiki.ros.org/tf/Tutorials)
